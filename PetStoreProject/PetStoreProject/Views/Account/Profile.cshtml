@{
    ViewData["Title"] = "Tài Khoản";
    var name = Context.Session.GetString("CustomerName");
}

@section HeadOptional {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        .img-account-profile {
            height: 9rem;
        }

        .rounded-circle {
            border-radius: 50% !important;
        }

        .card {
            box-shadow: 0 0.15rem 1.75rem 0 rgb(33 40 50 / 15%);
        }

        .card .card-header {
            font-size: 16px;
            font-weight: 600;
        }

        .card-header:first-child {
            border-radius: 0.35rem 0.35rem 0 0;
        }

        .card-header {
            padding: 1rem 1.35rem;
            margin-bottom: 0;
            background-color: rgba(33, 40, 50, 0.03);
            border-bottom: 1px solid rgba(33, 40, 50, 0.125);
        }

            .card-body .label-input {
            font-size: 15px;
        }

        .form-control, .dataTable-input {
            display: block;
            width: 100%;
            padding: 0.875rem 1.125rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1;
            color: black;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #c5ccd6;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 0.35rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .input-group-text:hover {
            cursor: pointer;
        }

        .profile_wrapper .profile-name {
            padding-top: 10px;
            font-size: 19px;
            color: black;
            font-weight: 500;
        }

        .profile_wrapper .show-btn {
            top: 37px;
        }

        .profile_wrapper .gender-title {
            padding: 1.15rem 1.15rem 1.15rem 2.15rem;
            display: inline-block;
            width: 35%;
            font-size: 19px;
        }

        .profile_wrapper .gender-radio{
            display: inline-block;
            width: 20%;
            font-size: 19px;
            color: black;
        }

        .profile_wrapper .gender-radio input{
            cursor: pointer;
        }

        .profile_wrapper .login-btn:hover{
            background-color: #00adf6;
            transition: all 0.3s ease-in-out 0s;
        }

        .profile-option-btn{
            padding-left: 30px;
            padding-right:0px;
            border: none;
            font-size: 16px;
        }
    </style>
}

<div class="profile_wrapper adp_top adp_bottom">
    <div class="container-xl px-4">
        <!-- Account page navigation-->
        <div class="row">
            <div class="col-xl-4">
                <!-- Profile picture card-->
                <div class="card mb-4 mb-xl-0">
                    <div class="card-header">Ảnh Đại Diện</div>
                    <div class="card-body text-center">
                        <!-- Profile picture image-->
                        <img class="img-account-profile rounded-circle mb-2" src="~/img/profile-user-2.png" alt="">
                        <!-- Profile picture help block-->
                        <div id="profile-full-name" class="profile-name">@name</div>
                        <!-- Profile picture upload button-->
                        @* <button class="btn btn-primary" type="button">Upload new image</button> *@
                    </div>
                    <div class="card-footer">
                        <div>
                            <a class="single-account-select profile-option-btn" onclick="profileDetail()">Thông Tin Tài Khoản</a>
                            <a class="single-account-select profile-option-btn" onclick="changePassword()">Đổi Mật Khẩu</a>
                            <a class="single-account-select profile-option-btn">Lịch Sử Đơn Hàng</a>
                        </div>
                    </div>
                </div>
            </div>
            <div id="main-content" class="col-xl-8">
            </div>
        </div>
    </div>
</div>
@section ScriptOptional {
    <script>
        $(document).ready(function () {
            profileDetail();
            initDatepicker();

            $("#formChangePassword").on("submit", function (event) {
                event.preventDefault();
                updateChangePassword();
            });
        });

        function profileDetail() {
            $.ajax({
                url: '@Url.Action("ProfileDetail", "Account")',
                type: 'Get',

                success: function (response) {
                    $("#main-content").empty();
                    $("#main-content").html(response);
                    initDatepicker();
                },

                error: function (xhr, status, error) {
                    console.error("Error:", error);
                }
            });
        };

        function updateProfileDetail() {
            var formProfileDetail = $("#formProfileDetail").serialize();
            $.ajax({
                url: '@Url.Action("ProfileDetail", "Account")',
                type: 'POST',
                data: formProfileDetail,

                success: function (response) {
                    $("#main-content").empty();
                    $("#main-content").html(response);
                    var currentName = $(response).find("#FullName").val();
                    $("#profile-full-name").text(currentName);
                    $("#menu-fullname").text(currentName);
                    initDatepicker();
                },

                error: function (xhr, status, error) {
                    console.error("Error:", error);
                }
            });
        };

        function changePassword() {
            $.ajax({
                url: '@Url.Action("ChangePassword", "Account")',
                type: 'GET',

                success: function (response) {
                    $("#main-content").empty();
                    $("#main-content").html(response);

                    $("#formChangePassword").on("submit", function (event) {
                        event.preventDefault();
                        updateChangePassword();
                    });
                },

                error: function (xhr, status, error) {
                    console.error("Error:", error);
                }
            });
        };

        function updateChangePassword() {
            var formChangePassword = $("#formChangePassword").serialize();
            $.ajax({
                url: '@Url.Action("ChangePassword", "Account")',
                type: 'POST',
                data: formChangePassword,

                success: function (response) {
                    $("#main-content").empty();
                    $("#main-content").html(response);

                    $("#formChangePassword").on("submit", function (event) {
                        event.preventDefault();
                        updateChangePassword();
                    });
                },

                error: function (xhr, status, error) {
                    console.error("Error:", error);
                }
            })
        }

        function initDatepicker() {
            $('#dob-datepicker').datepicker({
                format: "dd/mm/yyyy",
                weekStart: 1,
                startDate: "1/1/1910",
                startView: 2,
                maxViewMode: 2,
                language: "vi",
                autoclose: true,
                orientation: "bottom auto",
            });
        };


        function showOldPassword() {
            var pass = document.getElementById("OldPassword");
            var icon = document.getElementById("eye-icon-old");
            if (pass.type === "password") {
                pass.type = "text";
                icon.classList.replace("fa-eye-slash", "fa-eye");
            } else {
                pass.type = "password";
                icon.classList.replace("fa-eye", "fa-eye-slash");
            }
        }

        function showNewPassword() {
            var pass = document.getElementById("NewPassword");
            var icon = document.getElementById("eye-icon-new");
            if (pass.type === "password") {
                pass.type = "text";
                icon.classList.replace("fa-eye-slash", "fa-eye");
            } else {
                pass.type = "password";
                icon.classList.replace("fa-eye", "fa-eye-slash");
            }
        }

        function showConfirmPassword() {
            var pass = document.getElementById("ConfirmPassword");
            var icon = document.getElementById("eye-icon-confirm");
            if (pass.type === "password") {
                pass.type = "text";
                icon.classList.replace("fa-eye-slash", "fa-eye");
            } else {
                pass.type = "password";
                icon.classList.replace("fa-eye", "fa-eye-slash");
            }
        }

    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.vi.min.js"></script>
}
