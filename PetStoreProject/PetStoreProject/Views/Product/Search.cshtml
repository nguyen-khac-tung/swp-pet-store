@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@using PetStoreProject.ViewModels
@using System.Globalization

@{
    ViewData["Title"] = "Tìm kiếm";
}
<h3 style="margin: 20px auto; text-align: center;">
    Tìm thấy @Model.Count kết quả với từ khóa <b>"@ViewData["key"]"</b>
</h3>
@if (Model.Count > 0)
{
    <div class="container">
        <div class="row">
            @foreach (var p in Model)
            {
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 mb-4">
                    <div class="single-template-product d-flex flex-column h-100">
                        <!-- Product Image Start -->
                        <div class="pro-img">
                            <span class="sticker-sale">-25%</span>
                            <span class="sticker-new">New</span>
                            <a href="product-details.html">
                                <img class="primary-img" src="@p.img_url" alt="single-product">
                            </a>
                        </div>
                        <!-- Product Image End -->
                        <!-- Product Content Start -->
                        <div class="product_content_wrap flex-grow-1">
                            <div class="product_content">
                                <h4><a href="product-details.html">@p.ProductName</a></h4>
                                <div class="grid_price">
                                    <span class="regular-price">@p.price.ToString("#,###", CultureInfo.GetCultureInfo("vi-VN")) VND</span>
                                </div>
                            </div>
                        </div>
                        <div class="item_add_cart">
                            <a class="grid_compare" href="compare.html" title="Compare"><i class="icofont-random"></i></a>
                            <a class="grid_cart" href="cart.html" title="Add to Cart">Add To Cart</a>
                            <a class="grid_wishlist" title="Wishlist">
                                @if (ViewData["listPID"] != null)
                                {
                                    <i class="icofont-heart-alt @( ((List<int>)ViewData["listPID"]).Contains(p.ProductId) ? "favorite" : "not-favorite" )"
                                       data-id="@p.ProductId"
                                       style="color: @( ((List<int>)ViewData["listPID"]).Contains(p.ProductId) ? "red" : "black" ); cursor: pointer;"
                                       onclick="Toggle(@p.ProductId, this)"></i>
                                }
                                else
                                {
                                    <i class="icofont-heart-alt" onclick="Toggle(@p.ProductId, this)"></i>
                                }
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
} 
else
{
    <div class="container-search">
        <div class="message-box">
            <h1>Không tìm thấy sản phẩm</h1>
            <p>Rất tiếc, chúng tôi không thể tìm thấy sản phẩm bạn yêu cầu.</p>
            <a asp-action="Index" asp-controller="Home" class="btn">Quay lại trang chủ</a>
        </div>
		<img src="~/img/search/e7e8bc8f4f2ced9334d4a439118a5fb4.jpg" style="margin: 100px"/>
    </div>

    <style>
        .container-search {
            text-align: center;
        }

        .message-box {
            background-color: #ffffff;
            padding: 30px;
        }

            .message-box h1 {
                font-size: 24px;
                color: #333;
                margin-bottom: 10px;
            }

            .message-box p {
                font-size: 16px;
                color: #666;
                margin-bottom: 20px;
            }

            .message-box .btn {
                display: inline-block;
                padding: 10px 20px;
                background-color: #007bff;
                color: #ffffff;
                text-decoration: none;
                border-radius: 5px;
                transition: background-color 0.3s;
            }

            .message-box .btn:hover {
                    background-color: #0056b3;
            }
    </style>
}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    function Toggle(productId, element) {
        var $this = $(element); 
        var isFavorite = $this.hasClass('favorite');


        $this.toggleClass('favorite not-favorite');


        if (isFavorite) {
            $this.css('color', 'black');
        } else {
            $this.css('color', 'red');
        }

        $.ajax({
            url: '@Url.Action("ToggleFavorite", "Product")',
            type: 'POST',
            data: { productId: productId },
            success: function (response) {
                console.log('AJAX success:', response);
            },
            error: function (xhr, status, error) {
                console.error('AJAX error:', error);

                var errorMessage;
                switch (xhr.status) {
                    case 400:
                        errorMessage = 'Yêu cầu không hợp lệ. Vui lòng kiểm tra lại thông tin.';
                        break;
                    case 401:
                        errorMessage = 'Bạn chưa đăng nhập. Vui lòng đăng nhập để thực hiện thao tác này.';
                        break;
                    case 403:
                        errorMessage = 'Bạn không có quyền thực hiện thao tác này.';
                        break;
                    case 404:
                        errorMessage = 'Không tìm thấy sản phẩm. Vui lòng thử lại.';
                        break;
                    case 500:
                        errorMessage = 'Lỗi máy chủ. Vui lòng thử lại sau.';
                        break;
                    default:
                        errorMessage = 'Đã xảy ra lỗi không xác định. Vui lòng thử lại.';
                }

                alert(errorMessage);

                // Revert the favorite status on error
                $this.toggleClass('favorite not-favorite');
                if (isFavorite) {
                    $this.css('color', 'red');
                } else {
                    $this.css('color', 'black');
                }
            }
        });
    }
</script>